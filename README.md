# fmnas-site

This repository contains the source code for the newest portions of the 
website of the [Forget Me Not Animal Shelter](https://forgetmenotshelter.org) (Republic, WA).

Over time, the complete website will be migrated into this repository.

This code is written specifically for Forget Me Not and not intended for use in other applications;
however, it is provided here in case someone else finds it useful.

## License

At this time, all rights reserved by the Forget Me Not Animal Shelter.

## Deployment
This site is designed to be easy to deploy to any LAMP server, including shared web hosts such as Dreamhost.
To deploy, simply clone or checkout this repository and configure the server as below. 

### Requirements
* Linux (any POSIX-compatible OS should work)
* Apache (Litespeed or any other web server with .htaccess and PHP support should work)
* PHP 7.4+
    * GD (tested with 2.1.0)
        * libJPEG (tested with 8)
        * libPNG (tested with 1.6.34)
    * mysqli (tested with 7.4.3)
* MySQL (MariaDB should work)

### Configuration
* Point a domain to the `public` directory (this will be the public web root)
* Point a domain to the `admin` directory (this will be the admin interface root)
* Copy `secrets/config_sample.php` to `secrets/config.php` and update the configuration values 
* Import `schema.sql` into the MySQL database
* Update the public web templates in the `src/templates` and `src/errors` directories as desired
    * The current templates rely on the presence of `/assets/adopted.jpg` and `/assets/logo.png` in the public site

Additional static site content can be added by simply placing it in the `public` directory.
Files and directories that exist in this directory can be accessed at their natural URLs.

## Listings
(TODO)

Pet listing source code is stored as assets. These assets are **[Handlebars](https://handlebarsjs.com)** templates which
should yield **[Github Flavored Markdown](https://github.github.com/gfm/)** (which [may include arbitrary HTML](https://github.github.com/gfm/#raw-html);
the tagfilter extension is **not** used).

The following variables are likely to prove useful in listings:
* **pet**: Pet
    * Properties:
        * name: string
        * dob: string ("2020-03-28")
        * sex: Sex
            * name: string ("male")
        * species: Species
            * name: string ("cat")
            * plural: string ("cats")
            * 
        * fee: string ("$40")
    * Methods:
        * age(): string ("2 years old")
        * sex(): string ("male")
        * species(): string ("kitten")
* **litter**: Litter | null (TODO)
    * Properties: pets (a list of Pets)

## Technologies
**PHP** was chosen as the backend language to simplify deployment to Dreamhost shared hosting. 

[**Mithril**](https://mithril.js.org) is used in the admin interface. This library is chosen in lieu of
a heavyweight JavaScript framework and view library in order to eliminate the additional compilation step when deploying.

On the server side, listings are first compiled with [lightncandy](https://github.com/zordius/lightncandy),
then parsed with [Parsedown](https://parsedown.org/). Any PHP code embedded in listings will **not** be executed on the server. The resulting HTML is cached; the cached assets are automatically
deleted when listings are updated through the admin interface, but must be manually deleted if changes are made to the asset or 
corresponding database records outside the admin interface.

The client-side editor is [Toast UI Editor](https://ui.toast.com/tui-editor/). Need an extension for Handlebars support. Maybe use StackEdit or something instead.
CKEditor, Simditor
<!-- https://softwarerecs.stackexchange.com/questions/5746/markdown-editor-for-windows-with-live-rendering-in-the-editing-pane-not-in-a-se -->

The layout templates in `src/templates` are written in vanilla PHP/HTML.

### Server-side dependencies
`src/generated.php` is automatically generated by `src/generator.php` when it is needed.
`src/generated.php` should be deleted when changes are made to the database outside the admin interface
or `src/generator.php` is updated.

The listing parser (`src/parser.php`) depends on
[**lightncandy**](https://github.com/zordius/lightncandy) and
[**Parsedown**](https://parsedown.org/).

### Client-side dependencies
The admin interface imports [**Mithril**](https://mithril.js.org) from cdnjs.
The listing editor imports 
[**Toast UI Editor**](https://ui.toast.com/tui-editor/)
from the Toast CDN.

The error pages supplied in `src/errors` use images from [**http.cat**](https://http.cat).

The public site expects browser support for the following features, but should gracefully degrade when they are unavailable.
* CSS 2.1 support including attr() and inline-block (IE 8, Firefox 3, Chrome 4, Safari 3.1, Opera 10)
* CSS3 selectors (IE 9, Firefox 3.5, Chrome 4, Safari 3.2, Opera 10)
* Flexbox (IE 10, Firefox 28, Chrome 21, Safari 6.1, Opera 12.1)
* ::before animation (Edge 12, Firefox 4, Chrome 26, Opera 15)
* \<figcaption\> (IE 9, Firefox 4, Chrome 8, Safari 5.1, Opera 11.5)

As such, the public site should appear mostly complete on IE 10+, Edge, Firefox 28+, Chrome 21+, Safari 6.1+, and Opera 12.1+. 
As of March 2020, this includes approximately 98% of desktop users. The required features are supported by nearly 100% of mobile devices.


The admin site requires browser support for the following features:
* ECMAScript 5 (IE 10, Firefox 21, Chrome 23, Safari 6)